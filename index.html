



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation of patterns and conventions used in Go code at Uber.">
      
      
        <link rel="canonical" href="https://zchee.github.io/uber-go-guide/">
      
      
        <meta name="author" content="Uber Technologies, Inc">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.0">
    
    
      
        <title>Uber Go Style Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-89201129-1", "https://zchee.github.io/uber-go-guide/")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#uber-go-style-guide" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://zchee.github.io/uber-go-guide/" title="Uber Go Style Guide" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Uber Go Style Guide
            </span>
            <span class="md-header-nav__topic">
              
                Style Guide
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/zchee/uber-go-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    zchee/uber-go-guide
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://zchee.github.io/uber-go-guide/" title="Uber Go Style Guide" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Uber Go Style Guide
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/zchee/uber-go-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    zchee/uber-go-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Style Guide
      </label>
    
    <a href="." title="Style Guide" class="md-nav__link md-nav__link--active">
      Style Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guidelines" class="md-nav__link">
    Guidelines
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointers-to-interfaces" class="md-nav__link">
    Pointers to Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receivers-and-interfaces" class="md-nav__link">
    Receivers and Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-value-mutexes-are-valid" class="md-nav__link">
    Zero-value Mutexes are Valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-slices-and-maps-at-boundaries" class="md-nav__link">
    Copy Slices and Maps at Boundaries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#receiving-slices-and-maps" class="md-nav__link">
    Receiving Slices and Maps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returning-slices-and-maps" class="md-nav__link">
    Returning Slices and Maps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defer-to-clean-up" class="md-nav__link">
    Defer to Clean Up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-size-is-one-or-none" class="md-nav__link">
    Channel Size is One or None
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-enums-at-one" class="md-nav__link">
    Start Enums at One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-types" class="md-nav__link">
    Error Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-wrapping" class="md-nav__link">
    Error Wrapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-type-assertion-failures" class="md-nav__link">
    Handle Type Assertion Failures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-panic" class="md-nav__link">
    Don't Panic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-gouberorgatomic" class="md-nav__link">
    Use go.uber.org/atomic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefer-strconv-over-fmt" class="md-nav__link">
    Prefer strconv over fmt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-string-to-byte-conversion" class="md-nav__link">
    Avoid string-to-byte conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefer-specifying-map-capacity-hints" class="md-nav__link">
    Prefer Specifying Map Capacity Hints
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#style" class="md-nav__link">
    Style
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-consistent" class="md-nav__link">
    Be Consistent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-similar-declarations" class="md-nav__link">
    Group Similar Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-group-ordering" class="md-nav__link">
    Import Group Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-names" class="md-nav__link">
    Package Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-names" class="md-nav__link">
    Function Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-aliasing" class="md-nav__link">
    Import Aliasing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-grouping-and-ordering" class="md-nav__link">
    Function Grouping and Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-nesting" class="md-nav__link">
    Reduce Nesting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnecessary-else" class="md-nav__link">
    Unnecessary Else
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top-level-variable-declarations" class="md-nav__link">
    Top-level Variable Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefix-unexported-globals-with-_" class="md-nav__link">
    Prefix Unexported Globals with _
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-in-structs" class="md-nav__link">
    Embedding in Structs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-field-names-to-initialize-structs" class="md-nav__link">
    Use Field Names to Initialize Structs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-variable-declarations" class="md-nav__link">
    Local Variable Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nil-is-a-valid-slice" class="md-nav__link">
    nil is a valid slice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-scope-of-variables" class="md-nav__link">
    Reduce Scope of Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-naked-parameters" class="md-nav__link">
    Avoid Naked Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-raw-string-literals-to-avoid-escaping" class="md-nav__link">
    Use Raw String Literals to Avoid Escaping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-struct-references" class="md-nav__link">
    Initializing Struct References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-maps" class="md-nav__link">
    Initializing Maps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-strings-outside-printf" class="md-nav__link">
    Format Strings outside Printf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-printf-style-functions" class="md-nav__link">
    Naming Printf-style Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-tables" class="md-nav__link">
    Test Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-options" class="md-nav__link">
    Functional Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="home/" title="README" class="md-nav__link">
      README
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="CHANGELOG" class="md-nav__link">
      CHANGELOG
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="license/" title="LICENSE" class="md-nav__link">
      LICENSE
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="code_of_conduct/" title="CODE OF CONDUCT" class="md-nav__link">
      CODE OF CONDUCT
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guidelines" class="md-nav__link">
    Guidelines
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointers-to-interfaces" class="md-nav__link">
    Pointers to Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receivers-and-interfaces" class="md-nav__link">
    Receivers and Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-value-mutexes-are-valid" class="md-nav__link">
    Zero-value Mutexes are Valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-slices-and-maps-at-boundaries" class="md-nav__link">
    Copy Slices and Maps at Boundaries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#receiving-slices-and-maps" class="md-nav__link">
    Receiving Slices and Maps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returning-slices-and-maps" class="md-nav__link">
    Returning Slices and Maps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defer-to-clean-up" class="md-nav__link">
    Defer to Clean Up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-size-is-one-or-none" class="md-nav__link">
    Channel Size is One or None
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-enums-at-one" class="md-nav__link">
    Start Enums at One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-types" class="md-nav__link">
    Error Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-wrapping" class="md-nav__link">
    Error Wrapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-type-assertion-failures" class="md-nav__link">
    Handle Type Assertion Failures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-panic" class="md-nav__link">
    Don't Panic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-gouberorgatomic" class="md-nav__link">
    Use go.uber.org/atomic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefer-strconv-over-fmt" class="md-nav__link">
    Prefer strconv over fmt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-string-to-byte-conversion" class="md-nav__link">
    Avoid string-to-byte conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefer-specifying-map-capacity-hints" class="md-nav__link">
    Prefer Specifying Map Capacity Hints
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#style" class="md-nav__link">
    Style
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-consistent" class="md-nav__link">
    Be Consistent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-similar-declarations" class="md-nav__link">
    Group Similar Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-group-ordering" class="md-nav__link">
    Import Group Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-names" class="md-nav__link">
    Package Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-names" class="md-nav__link">
    Function Names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-aliasing" class="md-nav__link">
    Import Aliasing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-grouping-and-ordering" class="md-nav__link">
    Function Grouping and Ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-nesting" class="md-nav__link">
    Reduce Nesting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnecessary-else" class="md-nav__link">
    Unnecessary Else
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top-level-variable-declarations" class="md-nav__link">
    Top-level Variable Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefix-unexported-globals-with-_" class="md-nav__link">
    Prefix Unexported Globals with _
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-in-structs" class="md-nav__link">
    Embedding in Structs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-field-names-to-initialize-structs" class="md-nav__link">
    Use Field Names to Initialize Structs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-variable-declarations" class="md-nav__link">
    Local Variable Declarations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nil-is-a-valid-slice" class="md-nav__link">
    nil is a valid slice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-scope-of-variables" class="md-nav__link">
    Reduce Scope of Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-naked-parameters" class="md-nav__link">
    Avoid Naked Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-raw-string-literals-to-avoid-escaping" class="md-nav__link">
    Use Raw String Literals to Avoid Escaping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-struct-references" class="md-nav__link">
    Initializing Struct References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-maps" class="md-nav__link">
    Initializing Maps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-strings-outside-printf" class="md-nav__link">
    Format Strings outside Printf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-printf-style-functions" class="md-nav__link">
    Naming Printf-style Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-tables" class="md-nav__link">
    Test Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-options" class="md-nav__link">
    Functional Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zchee/uber-go-guide/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <!--

Editing this document:

- Discuss all changes in GitHub issues first.
- Update the table of contents as new sections are added or removed.
- Use tables for side-by-side code samples. See below.

Code Samples:

Use 2 spaces to indent. Horizontal real estate is important in side-by-side
samples.

For side-by-side code samples, use the following snippet.

<div class="highlight"><pre><span></span>&lt;table&gt;
&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Bad&lt;/th&gt;&lt;th&gt;Good&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;

```go
BAD CODE GOES HERE
```

&lt;/td&gt;&lt;td&gt;

```go
GOOD CODE GOES HERE
```

&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</pre></div>

(You need the empty lines between the <td> and code samples for it to be
treated as Markdown.)

If you need to add labels or descriptions below the code samples, add another
row before the </tbody></table> line.

<div class="highlight"><pre><span></span>&lt;tr&gt;
&lt;td&gt;DESCRIBE BAD CODE&lt;/td&gt;
&lt;td&gt;DESCRIBE GOOD CODE&lt;/td&gt;
&lt;/tr&gt;
</pre></div>

-->

<h1 id="uber-go-style-guide">Uber Go Style Guide</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#guidelines">Guidelines</a></li>
<li><a href="#pointers-to-interfaces">Pointers to Interfaces</a></li>
<li><a href="#receivers-and-interfaces">Receivers and Interfaces</a></li>
<li><a href="#zero-value-mutexes-are-valid">Zero-value Mutexes are Valid</a></li>
<li><a href="#copy-slices-and-maps-at-boundaries">Copy Slices and Maps at Boundaries</a></li>
<li><a href="#defer-to-clean-up">Defer to Clean Up</a></li>
<li><a href="#channel-size-is-one-or-none">Channel Size is One or None</a></li>
<li><a href="#start-enums-at-one">Start Enums at One</a></li>
<li><a href="#error-types">Error Types</a></li>
<li><a href="#error-wrapping">Error Wrapping</a></li>
<li><a href="#handle-type-assertion-failures">Handle Type Assertion Failures</a></li>
<li><a href="#dont-panic">Don't Panic</a></li>
<li><a href="#use-gouberorgatomic">Use go.uber.org/atomic</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#prefer-strconv-over-fmt">Prefer strconv over fmt</a></li>
<li><a href="#avoid-string-to-byte-conversion">Avoid string-to-byte conversion</a></li>
<li><a href="#prefer-specifying-map-capacity-hints">Prefer Specifying Map Capacity Hints</a></li>
<li><a href="#style">Style</a></li>
<li><a href="#be-consistent">Be Consistent</a></li>
<li><a href="#group-similar-declarations">Group Similar Declarations</a></li>
<li><a href="#import-group-ordering">Import Group Ordering</a></li>
<li><a href="#package-names">Package Names</a></li>
<li><a href="#function-names">Function Names</a></li>
<li><a href="#import-aliasing">Import Aliasing</a></li>
<li><a href="#function-grouping-and-ordering">Function Grouping and Ordering</a></li>
<li><a href="#reduce-nesting">Reduce Nesting</a></li>
<li><a href="#unnecessary-else">Unnecessary Else</a></li>
<li><a href="#top-level-variable-declarations">Top-level Variable Declarations</a></li>
<li><a href="#prefix-unexported-globals-with-_">Prefix Unexported Globals with _</a></li>
<li><a href="#embedding-in-structs">Embedding in Structs</a></li>
<li><a href="#use-field-names-to-initialize-structs">Use Field Names to Initialize Structs</a></li>
<li><a href="#local-variable-declarations">Local Variable Declarations</a></li>
<li><a href="#nil-is-a-valid-slice">nil is a valid slice</a></li>
<li><a href="#reduce-scope-of-variables">Reduce Scope of Variables</a></li>
<li><a href="#avoid-naked-parameters">Avoid Naked Parameters</a></li>
<li><a href="#use-raw-string-literals-to-avoid-escaping">Use Raw String Literals to Avoid Escaping</a></li>
<li><a href="#initializing-struct-references">Initializing Struct References</a></li>
<li><a href="#initializing-maps">Initializing Maps</a></li>
<li><a href="#format-strings-outside-printf">Format Strings outside Printf</a></li>
<li><a href="#naming-printf-style-functions">Naming Printf-style Functions</a></li>
<li><a href="#patterns">Patterns</a></li>
<li><a href="#test-tables">Test Tables</a></li>
<li><a href="#functional-options">Functional Options</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>Styles are the conventions that govern our code. The term style is a bit of a
misnomer, since these conventions cover far more than just source file
formatting—gofmt handles that for us.</p>
<p>The goal of this guide is to manage this complexity by describing in detail the
Dos and Don'ts of writing Go code at Uber. These rules exist to keep the code
base manageable while still allowing engineers to use Go language features
productively.</p>
<p>This guide was originally created by <a href="https://github.com/prashantv">Prashant Varanasi</a> and <a href="https://github.com/nomis52">Simon Newton</a> as
a way to bring some colleagues up to speed with using Go. Over the years it has
been amended based on feedback from others.</p>
<p>This documents idiomatic conventions in Go code that we follow at Uber. A lot
of these are general guidelines for Go, while others extend upon external
resources:</p>
<ol>
<li><a href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
<li><a href="https://github.com/golang/go/wiki/CodeReviewComments">The Go common mistakes guide</a></li>
</ol>
<p>All code should be error-free when run through <code>golint</code> and <code>go vet</code>. We
recommend setting up your editor to:</p>
<ul>
<li>Run <code>goimports</code> on save</li>
<li>Run <code>golint</code> and <code>go vet</code> to check for errors</li>
</ul>
<p>You can find information in editor support for Go tools here:
<a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p>
<h2 id="guidelines">Guidelines</h2>
<h3 id="pointers-to-interfaces">Pointers to Interfaces</h3>
<p>You almost never need a pointer to an interface. You should be passing
interfaces as values—the underlying data can still be a pointer.</p>
<p>An interface is two fields:</p>
<ol>
<li>A pointer to some type-specific information. You can think of this as
  "type."</li>
<li>Data pointer. If the data stored is a pointer, it’s stored directly. If
  the data stored is a value, then a pointer to the value is stored.</li>
</ol>
<p>If you want interface methods to modify the underlying data, you must use a
pointer.</p>
<h3 id="receivers-and-interfaces">Receivers and Interfaces</h3>
<p>Methods with value receivers can be called on pointers as well as values.</p>
<p>For example,</p>
<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">S</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">data</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">S</span><span class="p">)</span> <span class="nx">Read</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">S</span><span class="p">)</span> <span class="nx">Write</span><span class="p">(</span><span class="nx">str</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">data</span> <span class="p">=</span> <span class="nx">str</span>
<span class="p">}</span>

<span class="nx">sVals</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="nx">S</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;A&quot;</span><span class="p">}}</span>

<span class="c1">// You can only call Read using a value</span>
<span class="nx">sVals</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">Read</span><span class="p">()</span>

<span class="c1">// This will not compile:</span>
<span class="c1">//  sVals[1].Write(&quot;test&quot;)</span>

<span class="nx">sPtrs</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">S</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;A&quot;</span><span class="p">}}</span>

<span class="c1">// You can call both Read and Write using a pointer</span>
<span class="nx">sPtrs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">Read</span><span class="p">()</span>
<span class="nx">sPtrs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">Write</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
</pre></div>

<p>Similarly, an interface can be satisfied by a pointer, even if the method has a
value receiver.</p>
<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">F</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nx">f</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">S1</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">S1</span><span class="p">)</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{}</span>

<span class="kd">type</span> <span class="nx">S2</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">S2</span><span class="p">)</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">s1Val</span> <span class="o">:=</span> <span class="nx">S1</span><span class="p">{}</span>
<span class="nx">s1Ptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">S1</span><span class="p">{}</span>
<span class="nx">s2Val</span> <span class="o">:=</span> <span class="nx">S2</span><span class="p">{}</span>
<span class="nx">s2Ptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">S2</span><span class="p">{}</span>

<span class="kd">var</span> <span class="nx">i</span> <span class="nx">F</span>
<span class="nx">i</span> <span class="p">=</span> <span class="nx">s1Val</span>
<span class="nx">i</span> <span class="p">=</span> <span class="nx">s1Ptr</span>
<span class="nx">i</span> <span class="p">=</span> <span class="nx">s2Ptr</span>

<span class="c1">// The following doesn&#39;t compile, since s2Val is a value, and there is no value receiver for f.</span>
<span class="c1">//   i = s2Val</span>
</pre></div>

<p>Effective Go has a good write up on [Pointers vs. Values].</p>
<h3 id="zero-value-mutexes-are-valid">Zero-value Mutexes are Valid</h3>
<p>The zero-value of <code>sync.Mutex</code> and <code>sync.RWMutex</code> is valid, so you almost
never need a pointer to a mutex.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">mu</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">)</span>
<span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">mu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
</pre></div>

</td></tr>
</tbody></table>

<p>If you use a struct by pointer, then the mutex can be a non-pointer field.</p>
<p>Unexported structs that use a mutex to protect fields of the struct may embed
the mutex.</p>
<table>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">smap</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span> <span class="c1">// only for unexported types</span>

  <span class="nx">data</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">newSMap</span><span class="p">()</span> <span class="o">*</span><span class="nx">smap</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">smap</span><span class="p">{</span>
    <span class="nx">data</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">smap</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">k</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nx">m</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="nx">m</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">SMap</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">mu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>

  <span class="nx">data</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">NewSMap</span><span class="p">()</span> <span class="o">*</span><span class="nx">SMap</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">SMap</span><span class="p">{</span>
    <span class="nx">data</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">SMap</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">k</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="nx">m</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</td></tr>

</tr>
<tr>
<td>Embed for private types or types that need to implement the Mutex interface.</td>
<td>For exported types, use a private field.</td>
</tr>

</tbody></table>

<h3 id="copy-slices-and-maps-at-boundaries">Copy Slices and Maps at Boundaries</h3>
<p>Slices and maps contain pointers to the underlying data so be wary of scenarios
when they need to be copied.</p>
<h4 id="receiving-slices-and-maps">Receiving Slices and Maps</h4>
<p>Keep in mind that users can modify a map or slice you received as an argument
if you store a reference to it.</p>
<table>
<thead><tr><th>Bad</th> <th>Good</th></tr></thead>
<tbody>
<tr>
<td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">Driver</span><span class="p">)</span> <span class="nx">SetTrips</span><span class="p">(</span><span class="nx">trips</span> <span class="p">[]</span><span class="nx">Trip</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">d</span><span class="p">.</span><span class="nx">trips</span> <span class="p">=</span> <span class="nx">trips</span>
<span class="p">}</span>

<span class="nx">trips</span> <span class="o">:=</span> <span class="o">...</span>
<span class="nx">d1</span><span class="p">.</span><span class="nx">SetTrips</span><span class="p">(</span><span class="nx">trips</span><span class="p">)</span>

<span class="c1">// Did you mean to modify d1.trips?</span>
<span class="nx">trips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="o">...</span>
</pre></div>

</td>
<td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">Driver</span><span class="p">)</span> <span class="nx">SetTrips</span><span class="p">(</span><span class="nx">trips</span> <span class="p">[]</span><span class="nx">Trip</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">d</span><span class="p">.</span><span class="nx">trips</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">Trip</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">trips</span><span class="p">))</span>
  <span class="nb">copy</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">trips</span><span class="p">,</span> <span class="nx">trips</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">trips</span> <span class="o">:=</span> <span class="o">...</span>
<span class="nx">d1</span><span class="p">.</span><span class="nx">SetTrips</span><span class="p">(</span><span class="nx">trips</span><span class="p">)</span>

<span class="c1">// We can now modify trips[0] without affecting d1.trips.</span>
<span class="nx">trips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="o">...</span>
</pre></div>

</td>
</tr>

</tbody>
</table>

<h4 id="returning-slices-and-maps">Returning Slices and Maps</h4>
<p>Similarly, be wary of user modifications to maps or slices exposing internal
state.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Stats</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">mu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
  <span class="nx">counters</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// Snapshot returns the current stats.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stats</span><span class="p">)</span> <span class="nx">Snapshot</span><span class="p">()</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">counters</span>
<span class="p">}</span>

<span class="c1">// snapshot is no longer protected by the mutex, so any</span>
<span class="c1">// access to the snapshot is subject to data races.</span>
<span class="nx">snapshot</span> <span class="o">:=</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">Snapshot</span><span class="p">()</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Stats</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">mu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
  <span class="nx">counters</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stats</span><span class="p">)</span> <span class="nx">Snapshot</span><span class="p">()</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

  <span class="nx">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">counters</span><span class="p">))</span>
  <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">s</span><span class="p">.</span><span class="nx">counters</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">result</span>
<span class="p">}</span>

<span class="c1">// Snapshot is now a copy.</span>
<span class="nx">snapshot</span> <span class="o">:=</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">Snapshot</span><span class="p">()</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="defer-to-clean-up">Defer to Clean Up</h3>
<p>Use defer to clean up resources such as files and locks.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">p</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span> <span class="p">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span>
<span class="p">}</span>

<span class="nx">p</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<span class="nx">newCount</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="k">return</span> <span class="nx">newCount</span>

<span class="c1">// easy to miss unlocks due to multiple returns</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">p</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="k">defer</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span> <span class="p">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span>
<span class="p">}</span>

<span class="nx">p</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">count</span>

<span class="c1">// more readable</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Defer has an extremely small overhead and should be avoided only if you can
prove that your function execution time is in the order of nanoseconds. The
readability win of using defers is worth the miniscule cost of using them. This
is especially true for larger methods that have more than simple memory
accesses, where the other computations are more significant than the <code>defer</code>.</p>
<h3 id="channel-size-is-one-or-none">Channel Size is One or None</h3>
<p>Channels should usually have a size of one or be unbuffered. By default,
channels are unbuffered and have a size of zero. Any other size
must be subject to a high level of scrutiny. Consider how the size is
determined, what prevents the channel from filling up under load and blocking
writers, and what happens when this occurs.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// Ought to be enough for anybody!</span>
<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// Size of one</span>
<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// or</span>
<span class="c1">// Unbuffered channel, size of zero</span>
<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="start-enums-at-one">Start Enums at One</h3>
<p>The standard way of introducing enumerations in Go is to declare a custom type
and a <code>const</code> group with <code>iota</code>. Since variables have a 0 default value, you
should usually start your enums on a non-zero value.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Operation</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">Add</span> <span class="nx">Operation</span> <span class="p">=</span> <span class="kc">iota</span>
  <span class="nx">Subtract</span>
  <span class="nx">Multiply</span>
<span class="p">)</span>

<span class="c1">// Add=0, Subtract=1, Multiply=2</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Operation</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">Add</span> <span class="nx">Operation</span> <span class="p">=</span> <span class="kc">iota</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="nx">Subtract</span>
  <span class="nx">Multiply</span>
<span class="p">)</span>

<span class="c1">// Add=1, Subtract=2, Multiply=3</span>
</pre></div>

</td></tr>
</tbody></table>

<p>There are cases where using the zero value makes sense, for example when the
zero value case is the desirable default behavior.</p>
<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">LogOutput</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">LogToStdout</span> <span class="nx">LogOutput</span> <span class="p">=</span> <span class="kc">iota</span>
  <span class="nx">LogToFile</span>
  <span class="nx">LogToRemote</span>
<span class="p">)</span>

<span class="c1">// LogToStdout=0, LogToFile=1, LogToRemote=2</span>
</pre></div>

<!-- TODO: section on String methods for enums -->

<h3 id="error-types">Error Types</h3>
<p>There are various options for declaring errors:</p>
<ul>
<li>[<code>errors.New</code>] for errors with simple static strings</li>
<li>[<code>fmt.Errorf</code>] for formatted error strings</li>
<li>Custom types that implement an <code>Error()</code> method</li>
<li>Wrapped errors using [<code>"pkg/errors".Wrap</code>]</li>
</ul>
<p>When returning errors, consider the following to determine the best choice:</p>
<ul>
<li>Is this a simple error that needs no extra information? If so, [<code>errors.New</code>]
  should suffice.</li>
<li>Do the clients need to detect and handle this error? If so, you should use a
  custom type, and implement the <code>Error()</code> method.</li>
<li>Are you propagating an error returned by a downstream function? If so, check
  the <a href="#error-wrapping">section on error wrapping</a>.</li>
<li>Otherwise, [<code>fmt.Errorf</code>] is okay.</li>
</ul>
<p>If the client needs to detect the error, and you have created a simple error
using [<code>errors.New</code>], use a var for the error.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// package foo</span>

<span class="kd">func</span> <span class="nx">Open</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;could not open&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// package bar</span>

<span class="kd">func</span> <span class="nx">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">Open</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;could not open&quot;</span> <span class="p">{</span>
      <span class="c1">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;unknown error&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// package foo</span>

<span class="kd">var</span> <span class="nx">ErrCouldNotOpen</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;could not open&quot;</span><span class="p">)</span>

<span class="kd">func</span> <span class="nx">Open</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">ErrCouldNotOpen</span>
<span class="p">}</span>

<span class="c1">// package bar</span>

<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">Open</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">ErrCouldNotOpen</span> <span class="p">{</span>
    <span class="c1">// handle</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;unknown error&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>If you have an error that clients may need to detect, and you would like to add
more information to it (e.g., it is not a static string), then you should use a
custom type.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">open</span><span class="p">(</span><span class="nx">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;file %q not found&quot;</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">open</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span> <span class="s">&quot;not found&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;unknown error&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">errNotFound</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">file</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">errNotFound</span><span class="p">)</span> <span class="nx">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;file %q not found&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">open</span><span class="p">(</span><span class="nx">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">errNotFound</span><span class="p">{</span><span class="nx">file</span><span class="p">:</span> <span class="nx">file</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">open</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">errNotFound</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
      <span class="c1">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;unknown error&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Be careful with exporting custom error types directly since they become part of
the public API of the package. It is preferable to expose matcher functions to
check the error instead.</p>
<div class="highlight"><pre><span></span><span class="c1">// package foo</span>

<span class="kd">type</span> <span class="nx">errNotFound</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">file</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">errNotFound</span><span class="p">)</span> <span class="nx">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;file %q not found&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">IsNotFoundError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">errNotFound</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">ok</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">errNotFound</span><span class="p">{</span><span class="nx">file</span><span class="p">:</span> <span class="nx">file</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// package bar</span>

<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">IsNotFoundError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;unknown error&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<!-- TODO: Exposing the information to callers with accessor functions. -->

<h3 id="error-wrapping">Error Wrapping</h3>
<p>There are three main options for propagating errors if a call fails:</p>
<ul>
<li>Return the original error if there is no additional context to add and you
  want to maintain the original error type.</li>
<li>Add context using [<code>"pkg/errors".Wrap</code>] so that the error message provides
  more context and [<code>"pkg/errors".Cause</code>] can be used to extract the original
  error.</li>
<li>Use [<code>fmt.Errorf</code>] if the callers do not need to detect or handle that
  specific error case.</li>
</ul>
<p>It is recommended to add context where possible so that instead of a vague
error such as "connection refused", you get more useful errors such as
"call service foo: connection refused".</p>
<p>When adding context to returned errors, keep the context succinct by avoiding
phrases like "failed to", which state the obvious and pile up as the error
percolates up through the stack:</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">s</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span>
        <span class="s">&quot;failed to create new store: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">s</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span>
        <span class="s">&quot;new store: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<tr><td>

<div class="highlight"><pre><span></span>failed to x: failed to y: failed to create new store: the error
</pre></div>

</td><td>

<div class="highlight"><pre><span></span>x: y: new store: the error
</pre></div>

</td></tr>
</tbody></table>

<p>However once the error is sent to another system, it should be clear the
message is an error (e.g. an <code>err</code> tag or "Failed" prefix in logs).</p>
<p>See also <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Don't just check errors, handle them gracefully</a>.</p>
<h3 id="handle-type-assertion-failures">Handle Type Assertion Failures</h3>
<p>The single return value form of a <a href="https://golang.org/ref/spec#Type_assertions">type assertion</a> will panic on an incorrect
type. Therefore, always use the "comma ok" idiom.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">t</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">t</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
  <span class="c1">// handle the error gracefully</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<!-- TODO: There are a few situations where the single assignment form is
fine. -->

<h3 id="dont-panic">Don't Panic</h3>
<p>Code running in production must avoid panics. Panics are a major source of
<a href="https://en.wikipedia.org/wiki/Cascading_failure">cascading failures</a>. If an error occurs, the function must return an error and
allow the caller to decide how to handle it.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">bar</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;bar must not be empty&quot;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;USAGE: foo &lt;bar&gt;&quot;</span><span class="p">)</span>
    <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">foo</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">bar</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;bar must not be empty&quot;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;USAGE: foo &lt;bar&gt;&quot;</span><span class="p">)</span>
    <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Panic/recover is not an error handling strategy. A program must panic only when
something irrecoverable happens such as a nil dereference. An exception to this is
program initialization: bad things at program startup that should abort the
program may cause panic.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_statusTemplate</span> <span class="p">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;_statusHTML&quot;</span><span class="p">))</span>
</pre></div>

<p>Even in tests, prefer <code>t.Fatal</code> or <code>t.FailNow</code> over panics to ensure that the
test is marked as failed.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// func TestFoo(t *testing.T)</span>

<span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">TempFile</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;failed to set up test&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// func TestFoo(t *testing.T)</span>

<span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">TempFile</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;failed to set up test&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<!-- TODO: Explain how to use _test packages. -->

<h3 id="use-gouberorgatomic">Use go.uber.org/atomic</h3>
<p>Atomic operations with the <a href="https://golang.org/pkg/sync/atomic/">sync/atomic</a> package operate on the raw types
(<code>int32</code>, <code>int64</code>, etc.) so it is easy to forget to use the atomic operation to
read or modify the variables.</p>
<p><a href="https://godoc.org/go.uber.org/atomic">go.uber.org/atomic</a> adds type safety to these operations by hiding the
underlying type. Additionally, it includes a convenient <code>atomic.Bool</code> type.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">foo</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">running</span> <span class="kt">int32</span>  <span class="c1">// atomic</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span><span class="o">*</span> <span class="nx">foo</span><span class="p">)</span> <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">SwapInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">f</span><span class="p">.</span><span class="nx">running</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
     <span class="c1">// already running…</span>
     <span class="k">return</span>
  <span class="p">}</span>
  <span class="c1">// start the Foo</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">foo</span><span class="p">)</span> <span class="nx">isRunning</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">running</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1">// race!</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">foo</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">running</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">Bool</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">foo</span><span class="p">)</span> <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">running</span><span class="p">.</span><span class="nx">Swap</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// already running…</span>
     <span class="k">return</span>
  <span class="p">}</span>
  <span class="c1">// start the Foo</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">foo</span><span class="p">)</span> <span class="nx">isRunning</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">running</span><span class="p">.</span><span class="nx">Load</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h2 id="performance">Performance</h2>
<p>Performance-specific guidelines apply only to the hot path.</p>
<h3 id="prefer-strconv-over-fmt">Prefer strconv over fmt</h3>
<p>When converting primitives to/from strings, <code>strconv</code> is faster than
<code>fmt</code>.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprint</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Int</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Int</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>

</td></tr>
<tr><td>

<div class="highlight"><pre><span></span>BenchmarkFmtSprint-4    143 ns/op    2 allocs/op
</pre></div>

</td><td>

<div class="highlight"><pre><span></span>BenchmarkStrconv-4    64.2 ns/op    1 allocs/op
</pre></div>

</td></tr>
</tbody></table>

<h3 id="avoid-string-to-byte-conversion">Avoid string-to-byte conversion</h3>
<p>Do not create byte slices from a fixed string repeatedly. Instead, perform the
conversion once and capture the result.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">data</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</tr>
<tr><td>

<div class="highlight"><pre><span></span>BenchmarkBad-4   50000000   22.2 ns/op
</pre></div>

</td><td>

<div class="highlight"><pre><span></span>BenchmarkGood-4  500000000   3.25 ns/op
</pre></div>

</td></tr>
</tbody></table>

<h3 id="prefer-specifying-map-capacity-hints">Prefer Specifying Map Capacity Hints</h3>
<p>Where possible, provide capacity hints when initializing
maps with <code>make()</code>.</p>
<div class="highlight"><pre><span></span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">hint</span><span class="p">)</span>
</pre></div>

<p>Providing a capacity hint to <code>make()</code> tries to right-size the
map at initialization time, which reduces the need for growing
the map and allocations as elements are added to the map. Note
that the capacity hint is not guaranteed for maps, so adding
elements may still allocate even if a capacity hint is provided.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">)</span>

<span class="nx">files</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadDir</span><span class="p">(</span><span class="s">&quot;./files&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">files</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">Name</span><span class="p">()]</span> <span class="p">=</span> <span class="nx">f</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">files</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadDir</span><span class="p">(</span><span class="s">&quot;./files&quot;</span><span class="p">)</span>

<span class="nx">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">files</span><span class="p">))</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">files</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">Name</span><span class="p">()]</span> <span class="p">=</span> <span class="nx">f</span>
<span class="p">}</span>
</pre></div>

</td></tr>
<tr><td>

`m` is created without a size hint; there may be more
allocations at assignment time.

</td><td>

`m` is created with a size hint; there may be fewer
allocations at assignment time.

</td></tr>
</tbody></table>

<h2 id="style">Style</h2>
<h3 id="be-consistent">Be Consistent</h3>
<p>Some of the guidelines outlined in this document can be evaluated objectively;
others are situational, contextual, or subjective.</p>
<p>Above all else, <strong>be consistent</strong>.</p>
<p>Consistent code is easier to maintain, is easier to rationalize, requires less
cognitive overhead, and is easier to migrate or update as new conventions emerge
or classes of bugs are fixed.</p>
<p>Conversely, having multiple disparate or conflicting styles within a single
codebase causes maintenance overhead, uncertainty, and cognitive dissonance,
all of which can directly contribute to lower velocity, painful code reviews,
and bugs.</p>
<p>When applying these guidelines to a codebase, it is recommended that changes
are made at a package (or larger) level: application at a sub-package level
violates the above concern by introducing multiple styles into the same code.</p>
<h3 id="group-similar-declarations">Group Similar Declarations</h3>
<p>Go supports grouping similar declarations.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;a&quot;</span>
<span class="kn">import</span> <span class="s">&quot;b&quot;</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;a&quot;</span>
  <span class="s">&quot;b&quot;</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<p>This also applies to constants, variables, and type declarations.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">a</span> <span class="p">=</span> <span class="mi">1</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="p">=</span> <span class="mi">2</span>



<span class="kd">var</span> <span class="nx">a</span> <span class="p">=</span> <span class="mi">1</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="p">=</span> <span class="mi">2</span>



<span class="kd">type</span> <span class="nx">Area</span> <span class="kt">float64</span>
<span class="kd">type</span> <span class="nx">Volume</span> <span class="kt">float64</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="p">(</span>
  <span class="nx">a</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="nx">b</span> <span class="p">=</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
  <span class="nx">a</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="nx">b</span> <span class="p">=</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="p">(</span>
  <span class="nx">Area</span> <span class="kt">float64</span>
  <span class="nx">Volume</span> <span class="kt">float64</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Only group related declarations. Do not group declarations that are unrelated.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Operation</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">Add</span> <span class="nx">Operation</span> <span class="p">=</span> <span class="kc">iota</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="nx">Subtract</span>
  <span class="nx">Multiply</span>
  <span class="nx">ENV_VAR</span> <span class="p">=</span> <span class="s">&quot;MY_ENV&quot;</span>
<span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Operation</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">Add</span> <span class="nx">Operation</span> <span class="p">=</span> <span class="kc">iota</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="nx">Subtract</span>
  <span class="nx">Multiply</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">ENV_VAR</span> <span class="p">=</span> <span class="s">&quot;MY_ENV&quot;</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Groups are not limited in where they can be used. For example, you can use them
inside of functions.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">red</span> <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0xff0000</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">green</span> <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0x00ff00</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">blue</span> <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0x0000ff</span><span class="p">)</span>

  <span class="o">...</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="p">(</span>
    <span class="nx">red</span>   <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0xff0000</span><span class="p">)</span>
    <span class="nx">green</span> <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0x00ff00</span><span class="p">)</span>
    <span class="nx">blue</span>  <span class="p">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="mh">0x0000ff</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="o">...</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="import-group-ordering">Import Group Ordering</h3>
<p>There should be two import groups:</p>
<ul>
<li>Standard library</li>
<li>Everything else</li>
</ul>
<p>This is the grouping applied by goimports by default.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>
  <span class="s">&quot;go.uber.org/atomic&quot;</span>
  <span class="s">&quot;golang.org/x/sync/errgroup&quot;</span>
<span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>

  <span class="s">&quot;go.uber.org/atomic&quot;</span>
  <span class="s">&quot;golang.org/x/sync/errgroup&quot;</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="package-names">Package Names</h3>
<p>When naming packages, choose a name that is:</p>
<ul>
<li>All lower-case. No capitals or underscores.</li>
<li>Does not need to be renamed using named imports at most call sites.</li>
<li>Short and succinct. Remember that the name is identified in full at every call
  site.</li>
<li>Not plural. For example, <code>net/url</code>, not <code>net/urls</code>.</li>
<li>Not "common", "util", "shared", or "lib". These are bad, uninformative names.</li>
</ul>
<p>See also <a href="https://blog.golang.org/package-names">Package Names</a> and <a href="https://rakyll.org/style-packages/">Style guideline for Go packages</a>.</p>
<h3 id="function-names">Function Names</h3>
<p>We follow the Go community's convention of using <a href="https://golang.org/doc/effective_go.html#mixed-caps">MixedCaps for function
names</a>. An exception is made for test functions, which may contain underscores
for the purpose of grouping related test cases, e.g.,
<code>TestMyFunction_WhatIsBeingTested</code>.</p>
<h3 id="import-aliasing">Import Aliasing</h3>
<p>Import aliasing must be used if the package name does not match the last
element of the import path.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;net/http&quot;</span>

  <span class="nx">client</span> <span class="s">&quot;example.com/client-go&quot;</span>
  <span class="nx">trace</span> <span class="s">&quot;example.com/trace/v2&quot;</span>
<span class="p">)</span>
</pre></div>

<p>In all other scenarios, import aliases should be avoided unless there is a
direct conflict between imports.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>


  <span class="nx">nettrace</span> <span class="s">&quot;golang.net/x/trace&quot;</span>
<span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>
  <span class="s">&quot;runtime/trace&quot;</span>

  <span class="nx">nettrace</span> <span class="s">&quot;golang.net/x/trace&quot;</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="function-grouping-and-ordering">Function Grouping and Ordering</h3>
<ul>
<li>Functions should be sorted in rough call order.</li>
<li>Functions in a file should be grouped by receiver.</li>
</ul>
<p>Therefore, exported functions should appear first in a file, after
<code>struct</code>, <code>const</code>, <code>var</code> definitions.</p>
<p>A <code>newXYZ()</code>/<code>NewXYZ()</code> may appear after the type is defined, but before the
rest of the methods on the receiver.</p>
<p>Since functions are grouped by receiver, plain utility functions should appear
towards the end of the file.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">something</span><span class="p">)</span> <span class="nx">Cost</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">calcCost</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">weights</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">something</span> <span class="kd">struct</span><span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nx">calcCost</span><span class="p">(</span><span class="nx">n</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">something</span><span class="p">)</span> <span class="nx">Stop</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nx">newSomething</span><span class="p">()</span> <span class="o">*</span><span class="nx">something</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">something</span><span class="p">{}</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">something</span> <span class="kd">struct</span><span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nx">newSomething</span><span class="p">()</span> <span class="o">*</span><span class="nx">something</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">something</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">something</span><span class="p">)</span> <span class="nx">Cost</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">calcCost</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">weights</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">something</span><span class="p">)</span> <span class="nx">Stop</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nx">calcCost</span><span class="p">(</span><span class="nx">n</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="reduce-nesting">Reduce Nesting</h3>
<p>Code should reduce nesting where possible by handling error cases/special
conditions first and returning early or continuing the loop. Reduce the amount
of code that is nested multiple levels.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">data</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nx">F1</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
    <span class="nx">v</span> <span class="p">=</span> <span class="nx">process</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Call</span><span class="p">();</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">Send</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Invalid v: %v&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">data</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nx">F1</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Invalid v: %v&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="k">continue</span>
  <span class="p">}</span>

  <span class="nx">v</span> <span class="p">=</span> <span class="nx">process</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Call</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">err</span>
  <span class="p">}</span>
  <span class="nx">v</span><span class="p">.</span><span class="nx">Send</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="unnecessary-else">Unnecessary Else</h3>
<p>If a variable is set in both branches of an if, it can be replaced with a
single if.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
<span class="k">if</span> <span class="nx">b</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="p">=</span> <span class="mi">10</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">a</span> <span class="o">:=</span> <span class="mi">10</span>
<span class="k">if</span> <span class="nx">b</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="top-level-variable-declarations">Top-level Variable Declarations</h3>
<p>At the top level, use the standard <code>var</code> keyword. Do not specify the type,
unless it is not the same type as the expression.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_s</span> <span class="kt">string</span> <span class="p">=</span> <span class="nx">F</span><span class="p">()</span>

<span class="kd">func</span> <span class="nx">F</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;A&quot;</span> <span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_s</span> <span class="p">=</span> <span class="nx">F</span><span class="p">()</span>
<span class="c1">// Since F already states that it returns a string, we don&#39;t need to specify</span>
<span class="c1">// the type again.</span>

<span class="kd">func</span> <span class="nx">F</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;A&quot;</span> <span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Specify the type if the type of the expression does not match the desired type
exactly.</p>
<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">myError</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">myError</span><span class="p">)</span> <span class="nx">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;error&quot;</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nx">F</span><span class="p">()</span> <span class="nx">myError</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">myError</span><span class="p">{}</span> <span class="p">}</span>

<span class="kd">var</span> <span class="nx">_e</span> <span class="kt">error</span> <span class="p">=</span> <span class="nx">F</span><span class="p">()</span>
<span class="c1">// F returns an object of type myError but we want error.</span>
</pre></div>

<h3 id="prefix-unexported-globals-with-_">Prefix Unexported Globals with _</h3>
<p>Prefix unexported top-level <code>var</code>s and <code>const</code>s with <code>_</code> to make it clear when
they are used that they are global symbols.</p>
<p>Exception: Unexported error values, which should be prefixed with <code>err</code>.</p>
<p>Rationale: Top-level variables and constants have a package scope. Using a
generic name makes it easy to accidentally use the wrong value in a different
file.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// foo.go</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">defaultPort</span> <span class="p">=</span> <span class="mi">8080</span>
  <span class="nx">defaultUser</span> <span class="p">=</span> <span class="s">&quot;user&quot;</span>
<span class="p">)</span>

<span class="c1">// bar.go</span>

<span class="kd">func</span> <span class="nx">Bar</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">defaultPort</span> <span class="o">:=</span> <span class="mi">9090</span>
  <span class="o">...</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Default port&quot;</span><span class="p">,</span> <span class="nx">defaultPort</span><span class="p">)</span>

  <span class="c1">// We will not see a compile error if the first line of</span>
  <span class="c1">// Bar() is deleted.</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// foo.go</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">_defaultPort</span> <span class="p">=</span> <span class="mi">8080</span>
  <span class="nx">_defaultUser</span> <span class="p">=</span> <span class="s">&quot;user&quot;</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="embedding-in-structs">Embedding in Structs</h3>
<p>Embedded types (such as mutexes) should be at the top of the field list of a
struct, and there must be an empty line separating embedded fields from regular
fields.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Client</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">version</span> <span class="kt">int</span>
  <span class="nx">http</span><span class="p">.</span><span class="nx">Client</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Client</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">http</span><span class="p">.</span><span class="nx">Client</span>

  <span class="nx">version</span> <span class="kt">int</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="use-field-names-to-initialize-structs">Use Field Names to Initialize Structs</h3>
<p>You should almost always specify field names when initializing structs. This is
now enforced by [<code>go vet</code>].</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">k</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{</span><span class="s">&quot;John&quot;</span><span class="p">,</span> <span class="s">&quot;Doe&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">k</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{</span>
    <span class="nx">FirstName</span><span class="p">:</span> <span class="s">&quot;John&quot;</span><span class="p">,</span>
    <span class="nx">LastName</span><span class="p">:</span> <span class="s">&quot;Doe&quot;</span><span class="p">,</span>
    <span class="nx">Admin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Exception: Field names <em>may</em> be omitted in test tables when there are 3 or
fewer fields.</p>
<div class="highlight"><pre><span></span><span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
  <span class="nx">op</span> <span class="nx">Operation</span>
  <span class="nx">want</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="p">{</span><span class="nx">Add</span><span class="p">,</span> <span class="s">&quot;add&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">Subtract</span><span class="p">,</span> <span class="s">&quot;subtract&quot;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>

<h3 id="local-variable-declarations">Local Variable Declarations</h3>
<p>Short variable declarations (<code>:=</code>) should be used if a variable is being set to
some value explicitly.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">s</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">s</span> <span class="o">:=</span> <span class="s">&quot;foo&quot;</span>
</pre></div>

</td></tr>
</tbody></table>

<p>However, there are cases where the default value is clearer when the <code>var</code>
keyword is used. <a href="https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices">Declaring Empty Slices</a>, for example.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">list</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">filtered</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">list</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">v</span> <span class="p">&gt;</span> <span class="mi">10</span> <span class="p">{</span>
      <span class="nx">filtered</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">filtered</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">list</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">filtered</span> <span class="p">[]</span><span class="kt">int</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">list</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">v</span> <span class="p">&gt;</span> <span class="mi">10</span> <span class="p">{</span>
      <span class="nx">filtered</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">filtered</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="nil-is-a-valid-slice">nil is a valid slice</h3>
<p><code>nil</code> is a valid slice of length 0. This means that,</p>
<ul>
<li>You should not return a slice of length zero explicitly. Return <code>nil</code>
  instead.</li>
</ul>
<p><table>
  <thead><tr><th>Bad</th><th>Good</th></tr></thead>
  <tbody>
  <tr><td></p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<span class="p">}</span>
</pre></div>

<p></td><td></p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>

<p></td></tr>
  </tbody></table></p>
<ul>
<li>To check if a slice is empty, always use <code>len(s) == 0</code>. Do not check for
  <code>nil</code>.</li>
</ul>
<p><table>
  <thead><tr><th>Bad</th><th>Good</th></tr></thead>
  <tbody>
  <tr><td></p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">s</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">s</span> <span class="o">==</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>

<p></td><td></p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">s</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>

<p></td></tr>
  </tbody></table></p>
<ul>
<li>The zero value (a slice declared with <code>var</code>) is usable immediately without
  <code>make()</code>.</li>
</ul>
<p><table>
  <thead><tr><th>Bad</th><th>Good</th></tr></thead>
  <tbody>
  <tr><td></p>
<div class="highlight"><pre><span></span><span class="nx">nums</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<span class="c1">// or, nums := make([]int)</span>

<span class="k">if</span> <span class="nx">add1</span> <span class="p">{</span>
  <span class="nx">nums</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nx">add2</span> <span class="p">{</span>
  <span class="nx">nums</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p></td><td></p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span>

<span class="k">if</span> <span class="nx">add1</span> <span class="p">{</span>
  <span class="nx">nums</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nx">add2</span> <span class="p">{</span>
  <span class="nx">nums</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p></td></tr>
  </tbody></table></p>
<h3 id="reduce-scope-of-variables">Reduce Scope of Variables</h3>
<p>Where possible, reduce scope of variables. Do not reduce the scope if it
conflicts with <a href="#reduce-nesting">Reduce Nesting</a>.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
 <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
 <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>If you need a result of a function call outside of the if, then you should not
try to reduce the scope.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">err</span> <span class="p">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">err</span>
  <span class="p">}</span>

  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">cfg</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">cfg</span><span class="p">)</span>
<span class="k">return</span> <span class="kc">nil</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="avoid-naked-parameters">Avoid Naked Parameters</h3>
<p>Naked parameters in function calls can hurt readability. Add C-style comments
(<code>/* ... */</code>) for parameter names when their meaning is not obvious.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// func printInfo(name string, isLocal, done bool)</span>

<span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// func printInfo(name string, isLocal, done bool)</span>

<span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="kc">true</span> <span class="cm">/* isLocal */</span><span class="p">,</span> <span class="kc">true</span> <span class="cm">/* done */</span><span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Better yet, replace naked <code>bool</code> types with custom types for more readable and
type-safe code. This allows more than just two states (true/false) for that
parameter in the future.</p>
<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Region</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">UnknownRegion</span> <span class="nx">Region</span> <span class="p">=</span> <span class="kc">iota</span>
  <span class="nx">Local</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Status</span> <span class="kt">int</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">StatusReady</span> <span class="p">=</span> <span class="kc">iota</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="nx">StatusDone</span>
  <span class="c1">// Maybe we will have a StatusInProgress in the future.</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">printInfo</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">region</span> <span class="nx">Region</span><span class="p">,</span> <span class="nx">status</span> <span class="nx">Status</span><span class="p">)</span>
</pre></div>

<h3 id="use-raw-string-literals-to-avoid-escaping">Use Raw String Literals to Avoid Escaping</h3>
<p>Go supports <a href="https://golang.org/ref/spec#raw_string_lit">raw string literals</a>,
which can span multiple lines and include quotes. Use these to avoid
hand-escaped strings which are much harder to read.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">wantError</span> <span class="o">:=</span> <span class="s">&quot;unknown name:\&quot;test\&quot;&quot;</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">wantError</span> <span class="o">:=</span> <span class="s">`unknown error:&quot;test&quot;`</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="initializing-struct-references">Initializing Struct References</h3>
<p>Use <code>&amp;T{}</code> instead of <code>new(T)</code> when initializing struct references so that it
is consistent with the struct initialization.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">sval</span> <span class="o">:=</span> <span class="nx">T</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span><span class="p">}</span>

<span class="c1">// inconsistent</span>
<span class="nx">sptr</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span>
<span class="nx">sptr</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">sval</span> <span class="o">:=</span> <span class="nx">T</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span><span class="p">}</span>

<span class="nx">sptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">T</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&quot;bar&quot;</span><span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="initializing-maps">Initializing Maps</h3>
<p>Prefer <code>make(..)</code> for empty maps, and maps populated
programmatically. This makes map initialization visually
distinct from declaration, and it makes it easy to add size
hints later if available.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="p">(</span>
  <span class="c1">// m1 is safe to read and write;</span>
  <span class="c1">// m2 will panic on writes.</span>
  <span class="nx">m1</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span><span class="p">{}</span>
  <span class="nx">m2</span> <span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span>
<span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="p">(</span>
  <span class="c1">// m1 is safe to read and write;</span>
  <span class="c1">// m2 will panic on writes.</span>
  <span class="nx">m1</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span><span class="p">)</span>
  <span class="nx">m2</span> <span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span>
<span class="p">)</span>
</pre></div>

</td></tr>
<tr><td>

Declaration and initialization are visually similar.

</td><td>

Declaration and initialization are visually distinct.

</td></tr>
</tbody></table>

<p>Where possible, provide capacity hints when initializing
maps with <code>make()</code>. See
<a href="#prefer-specifying-map-capacity-hints">Prefer Specifying Map Capacity Hints</a>
for more information.</p>
<p>On the other hand, if the map holds a fixed list of elements,
use map literals to initialize the map.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">m</span><span class="p">[</span><span class="nx">k1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v1</span>
<span class="nx">m</span><span class="p">[</span><span class="nx">k2</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v2</span>
<span class="nx">m</span><span class="p">[</span><span class="nx">k3</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v3</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="nx">m</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="nx">T1</span><span class="p">]</span><span class="nx">T2</span><span class="p">{</span>
  <span class="nx">k1</span><span class="p">:</span> <span class="nx">v1</span><span class="p">,</span>
  <span class="nx">k2</span><span class="p">:</span> <span class="nx">v2</span><span class="p">,</span>
  <span class="nx">k3</span><span class="p">:</span> <span class="nx">v3</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>The basic rule of thumb is to use map literals when adding a fixed set of
elements at initialization time, otherwise use <code>make</code> (and specify a size hint
if available).</p>
<h3 id="format-strings-outside-printf">Format Strings outside Printf</h3>
<p>If you declare format strings for <code>Printf</code>-style functions outside a string
literal, make them <code>const</code> values.</p>
<p>This helps <code>go vet</code> perform static analysis of the format string.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="nx">msg</span> <span class="o">:=</span> <span class="s">&quot;unexpected values %v, %v\n&quot;</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">msg</span> <span class="p">=</span> <span class="s">&quot;unexpected values %v, %v\n&quot;</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<h3 id="naming-printf-style-functions">Naming Printf-style Functions</h3>
<p>When you declare a <code>Printf</code>-style function, make sure that <code>go vet</code> can detect
it and check the format string.</p>
<p>This means that you should use predefined <code>Printf</code>-style function
names if possible. <code>go vet</code> will check these by default. See <a href="https://golang.org/cmd/vet/#hdr-Printf_family">Printf family</a>
for more information.</p>
<p>If using the predefined names is not an option, end the name you choose with
f: <code>Wrapf</code>, not <code>Wrap</code>. <code>go vet</code> can be asked to check specific <code>Printf</code>-style
names but they must end with f.</p>
<div class="highlight"><pre><span></span>$ go vet -printfuncs<span class="o">=</span>wrapf,statusf
</pre></div>

<p>See also <a href="https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/">go vet: Printf family check</a>.</p>
<h2 id="patterns">Patterns</h2>
<h3 id="test-tables">Test Tables</h3>
<p>Use table-driven tests with <a href="https://blog.golang.org/subtests">subtests</a> to avoid duplicating code when the core
test logic is repetitive.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// func TestSplitHostPort(t *testing.T)</span>

<span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;192.0.2.0:8000&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;8000&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;192.0.2.0:http&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;:8000&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;8000&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;1:8&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">&quot;8&quot;</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="c1">// func TestSplitHostPort(t *testing.T)</span>

<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
  <span class="nx">give</span>     <span class="kt">string</span>
  <span class="nx">wantHost</span> <span class="kt">string</span>
  <span class="nx">wantPort</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="p">{</span>
    <span class="nx">give</span><span class="p">:</span>     <span class="s">&quot;192.0.2.0:8000&quot;</span><span class="p">,</span>
    <span class="nx">wantHost</span><span class="p">:</span> <span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span>
    <span class="nx">wantPort</span><span class="p">:</span> <span class="s">&quot;8000&quot;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">give</span><span class="p">:</span>     <span class="s">&quot;192.0.2.0:http&quot;</span><span class="p">,</span>
    <span class="nx">wantHost</span><span class="p">:</span> <span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span>
    <span class="nx">wantPort</span><span class="p">:</span> <span class="s">&quot;http&quot;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">give</span><span class="p">:</span>     <span class="s">&quot;:8000&quot;</span><span class="p">,</span>
    <span class="nx">wantHost</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
    <span class="nx">wantPort</span><span class="p">:</span> <span class="s">&quot;8000&quot;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">give</span><span class="p">:</span>     <span class="s">&quot;1:8&quot;</span><span class="p">,</span>
    <span class="nx">wantHost</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
    <span class="nx">wantPort</span><span class="p">:</span> <span class="s">&quot;8&quot;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">)</span>
    <span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantHost</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantPort</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>

</td></tr>
</tbody></table>

<p>Test tables make it easier to add context to error messages, reduce duplicate
logic, and add new test cases.</p>
<p>We follow the convention that the slice of structs is referred to as <code>tests</code>
and each test case <code>tt</code>. Further, we encourage explicating the input and output
values for each test case with <code>give</code> and <code>want</code> prefixes.</p>
<div class="highlight"><pre><span></span><span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
  <span class="nx">give</span>     <span class="kt">string</span>
  <span class="nx">wantHost</span> <span class="kt">string</span>
  <span class="nx">wantPort</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<h3 id="functional-options">Functional Options</h3>
<p>Functional options is a pattern in which you declare an opaque <code>Option</code> type
that records information in some internal struct. You accept a variadic number
of these options and act upon the full information recorded by the options on
the internal struct.</p>
<p>Use this pattern for optional arguments in constructors and other public APIs
that you foresee needing to expand, especially if you already have three or
more arguments on those functions.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

<div class="highlight"><pre><span></span><span class="c1">// package db</span>

<span class="kd">func</span> <span class="nx">Connect</span><span class="p">(</span>
  <span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span>
  <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span>
  <span class="nx">caching</span> <span class="kt">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Timeout and caching must always be provided,</span>
<span class="c1">// even if the user wants to use the default.</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">DefaultTimeout</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">DefaultCaching</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">newTimeout</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">DefaultCaching</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">DefaultTimeout</span><span class="p">,</span> <span class="kc">false</span> <span class="cm">/* caching */</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">newTimeout</span><span class="p">,</span> <span class="kc">false</span> <span class="cm">/* caching */</span><span class="p">)</span>
</pre></div>

</td><td>

<div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">options</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
  <span class="nx">caching</span> <span class="kt">bool</span>
<span class="p">}</span>

<span class="c1">// Option overrides behavior of Connect.</span>
<span class="kd">type</span> <span class="nx">Option</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nx">apply</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">optionFunc</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">optionFunc</span><span class="p">)</span> <span class="nx">apply</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">f</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="nx">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">optionFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">timeout</span> <span class="p">=</span> <span class="nx">t</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">WithCaching</span><span class="p">(</span><span class="nx">cache</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">optionFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">caching</span> <span class="p">=</span> <span class="nx">cache</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Connect creates a connection.</span>
<span class="kd">func</span> <span class="nx">Connect</span><span class="p">(</span>
  <span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span>
  <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">:=</span> <span class="nx">options</span><span class="p">{</span>
    <span class="nx">timeout</span><span class="p">:</span> <span class="nx">defaultTimeout</span><span class="p">,</span>
    <span class="nx">caching</span><span class="p">:</span> <span class="nx">defaultCaching</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">o</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Options must be provided only if needed.</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">newTimeout</span><span class="p">))</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nx">WithCaching</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span>
  <span class="nx">addr</span><span class="p">,</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">WithCaching</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">newTimeout</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>

</td></tr>
</tbody></table>

<p>See also,</p>
<ul>
<li><a href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html">Self-referential functions and the design of options</a></li>
<li><a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis">Functional options for friendly APIs</a></li>
</ul>
<!-- TODO: replace this with parameter structs and functional options, when to
use one vs other -->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="home/" title="README" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                README
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.a8b5e56f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
        <script src="search/main.js"></script>
      
    
  </body>
</html>